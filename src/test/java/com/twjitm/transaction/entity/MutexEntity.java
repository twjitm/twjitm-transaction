package com.twjitm.transaction.entity;import com.twjitm.transaction.service.redis.NettyTransactionRedisService;import com.twjitm.transaction.transaction.entity.AbstractNettyTransactionEntity;import com.twjitm.transaction.transaction.enums.NettyTransactionCommitResult;import com.twjitm.transaction.transaction.enums.NettyTransactionEntityCause;import com.twjitm.transaction.transaction.exception.NettyTransactionException;import java.util.BitSet;/** * 互斥锁测试 实体 * * @author twjitm - [Created on 2018-08-27 18:12] * @company https://github.com/twjitm * @jdk java version "1.8.0_77" */public class MutexEntity extends AbstractNettyTransactionEntity {    NettyTransactionRedisService redisService;    String testKey;    public MutexEntity(NettyTransactionEntityCause cause, String key,                       NettyTransactionRedisService redisService) {        super(cause, key, redisService);        this.redisService = redisService;        this.testKey = key;    }    @Override    public void commit() throws NettyTransactionException {        redisService.setString("mutex_test", "twjitm");        throw new NullPointerException();    }    @Override    public void rollback() throws NettyTransactionException {        BitSet bitset = getProgressBitSet();        for (int i = 0; i < bitset.size(); i++) {            //@TODO 不同粒度回滚        }        redisService.deleteKey("mutex_test");    }    @Override    public NettyTransactionCommitResult tryCommit() throws NettyTransactionException {        return NettyTransactionCommitResult.SUCCESS;    }}